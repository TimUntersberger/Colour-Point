[1mdiff --git a/.babelrc b/.babelrc[m
[1mindex 917bb62..6d78acd 100644[m
[1m--- a/.babelrc[m
[1m+++ b/.babelrc[m
[36m@@ -1,4 +1,4 @@[m
[31m-{[m
[31m-	"presets": ["env"],[m
[31m-	"ignore": ["node_modules", "*.hbs"][m
[32m+[m[32m{[m[41m[m
[32m+[m	[32m"presets": ["env"],[m[41m[m
[32m+[m	[32m"ignore": ["node_modules", "*.hbs"][m[41m[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/.gitignore b/.gitignore[m
[1mindex 82701fe..17966be 100644[m
[1m--- a/.gitignore[m
[1m+++ b/.gitignore[m
[36m@@ -1,19 +1,19 @@[m
[31m-# See https://help.github.com/articles/ignoring-files for more about ignoring files.[m
[31m-#[m
[31m-# If you find yourself ignoring temporary files generated by your text editor[m
[31m-# or operating system, you probably want to add a global ignore instead:[m
[31m-#   git config --global core.excludesfile '~/.gitignore_global'[m
[31m-[m
[31m-# Ignore bundler config.[m
[31m-/.bundle[m
[31m-[m
[31m-# Ignore all logfiles and tempfiles.[m
[31m-/log/*[m
[31m-/tmp/*[m
[31m-!/log/.keep[m
[31m-!/tmp/.keep[m
[31m-[m
[31m-/node_modules[m
[31m-/yarn-error.log[m
[31m-[m
[31m-.byebug_history[m
[32m+[m[32m# See https://help.github.com/articles/ignoring-files for more about ignoring files.[m[41m[m
[32m+[m[32m#[m[41m[m
[32m+[m[32m# If you find yourself ignoring temporary files generated by your text editor[m[41m[m
[32m+[m[32m# or operating system, you probably want to add a global ignore instead:[m[41m[m
[32m+[m[32m#   git config --global core.excludesfile '~/.gitignore_global'[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Ignore bundler config.[m[41m[m
[32m+[m[32m/.bundle[m[41m[m
[32m+[m[41m[m
[32m+[m[32m# Ignore all logfiles and tempfiles.[m[41m[m
[32m+[m[32m/log/*[m[41m[m
[32m+[m[32m/tmp/*[m[41m[m
[32m+[m[32m!/log/.keep[m[41m[m
[32m+[m[32m!/tmp/.keep[m[41m[m
[32m+[m[41m[m
[32m+[m[32m/node_modules[m[41m[m
[32m+[m[32m/yarn-error.log[m[41m[m
[32m+[m[41m[m
[32m+[m[32m.byebug_history[m[41m[m
[1mdiff --git a/README.md b/README.md[m
[1mindex fa97a82..84d0d62 100644[m
[1m--- a/README.md[m
[1m+++ b/README.md[m
[36m@@ -1 +1 @@[m
[31m-# NodeTemplate[m
[32m+[m[32m# NodeTemplate[m[41m[m
[1mdiff --git a/jsconfig.json b/jsconfig.json[m
[1mindex a39773d..19884c8 100644[m
[1m--- a/jsconfig.json[m
[1m+++ b/jsconfig.json[m
[36m@@ -1,6 +1,6 @@[m
[31m-{[m
[31m-  "exclude": ["node_modules"],[m
[31m-  "typeAcquisition": {[m
[31m-    "include": ["jquery"][m
[31m-  }[m
[31m-}[m
[32m+[m[32m{[m[41m[m
[32m+[m[32m  "exclude": ["node_modules"],[m[41m[m
[32m+[m[32m  "typeAcquisition": {[m[41m[m
[32m+[m[32m    "include": ["jquery"][m[41m[m
[32m+[m[32m  }[m[41m[m
[32m+[m[32m}[m[41m[m
[1mdiff --git a/public/css/layout.css b/public/css/layout.css[m
[1mindex c2ea527..434b500 100644[m
[1m--- a/public/css/layout.css[m
[1m+++ b/public/css/layout.css[m
[36m@@ -1,6 +1,6 @@[m
[31m-.navbar {[m
[31m-  margin-bottom: 30px !important;[m
[31m-}[m
[31m-.template {[m
[31m-  display: none !important;[m
[31m-}[m
[32m+[m[32m.navbar {[m[41m[m
[32m+[m[32m  margin-bottom: 30px !important;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.template {[m[41m[m
[32m+[m[32m  display: none !important;[m[41m[m
[32m+[m[32m}[m[41m[m
[1mdiff --git a/public/css/repository.css b/public/css/repository.css[m
[1mindex d2a7974..51a7796 100644[m
[1m--- a/public/css/repository.css[m
[1m+++ b/public/css/repository.css[m
[36m@@ -1,53 +1,53 @@[m
[31m-pre{[m
[31m-    padding: 0;[m
[31m-    margin: 0;[m
[31m-    font: inherit;[m
[31m-}[m
[31m-.addCategory:hover {[m
[31m-    cursor: pointer;[m
[31m-}[m
[31m-.categoriesManager {[m
[31m-    position: fixed;[m
[31m-    margin-top: 0 !important;[m
[31m-    margin-left: 20px !important;[m
[31m-}[m
[31m-.addMaterial {[m
[31m-    float: right;[m
[31m-}[m
[31m-.addMaterial:hover {[m
[31m-    cursor: pointer;[m
[31m-}[m
[31m-.min-quantity {[m
[31m-    /*display: none !important;*/[m
[31m-}[m
[31m-.removeMaterial:hover {[m
[31m-    cursor: pointer;[m
[31m-}[m
[31m-.removeMaterial {[m
[31m-    float: right;[m
[31m-    background-color: white;[m
[31m-}[m
[31m-.addQuantity {[m
[31m-    float: right;[m
[31m-}[m
[31m-.addQuantity:hover {[m
[31m-    cursor: pointer;[m
[31m-}[m
[31m-.subtractQuantity {[m
[31m-    float: right;[m
[31m-}[m
[31m-.subtractQuantity:hover {[m
[31m-    cursor: pointer;[m
[31m-}[m
[31m-#categoryNameSetting {[m
[31m-    float: right !important;[m
[31m-    border: none;[m
[31m-    border-bottom: solid black 0.5px;[m
[31m-    margin-right: 10px;[m
[31m-}[m
[31m-#categoryNameSettingButton:hover{[m
[31m-    cursor:pointer;[m
[31m-}[m
[31m-.materialName{[m
[31m-    padding-left: 5px !important;[m
[32m+[m[32mpre{[m[41m[m
[32m+[m[32m    padding: 0;[m[41m[m
[32m+[m[32m    margin: 0;[m[41m[m
[32m+[m[32m    font: inherit;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.addCategory:hover {[m[41m[m
[32m+[m[32m    cursor: pointer;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.categoriesManager {[m[41m[m
[32m+[m[32m    position: fixed;[m[41m[m
[32m+[m[32m    margin-top: 0 !important;[m[41m[m
[32m+[m[32m    margin-left: 20px !important;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.addMaterial {[m[41m[m
[32m+[m[32m    float: right;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.addMaterial:hover {[m[41m[m
[32m+[m[32m    cursor: pointer;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.min-quantity {[m[41m[m
[32m+[m[32m    /*display: none !important;*/[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.removeMaterial:hover {[m[41m[m
[32m+[m[32m    cursor: pointer;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.removeMaterial {[m[41m[m
[32m+[m[32m    float: right;[m[41m[m
[32m+[m[32m    background-color: white;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.addQuantity {[m[41m[m
[32m+[m[32m    float: right;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.addQuantity:hover {[m[41m[m
[32m+[m[32m    cursor: pointer;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.subtractQuantity {[m[41m[m
[32m+[m[32m    float: right;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.subtractQuantity:hover {[m[41m[m
[32m+[m[32m    cursor: pointer;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m#categoryNameSetting {[m[41m[m
[32m+[m[32m    float: right !important;[m[41m[m
[32m+[m[32m    border: none;[m[41m[m
[32m+[m[32m    border-bottom: solid black 0.5px;[m[41m[m
[32m+[m[32m    margin-right: 10px;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m#categoryNameSettingButton:hover{[m[41m[m
[32m+[m[32m    cursor:pointer;[m[41m[m
[32m+[m[32m}[m[41m[m
[32m+[m[32m.materialName{[m[41m[m
[32m+[m[32m    padding-left: 5px !important;[m[41m[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/public/js/layout.js b/public/js/layout.js[m
[1mindex 86ccba7..1085c45 100644[m
[1m--- a/public/js/layout.js[m
[1m+++ b/public/js/layout.js[m
[36m@@ -1,11 +1,11 @@[m
[31m-const onMenuItemSelected = event => {[m
[31m-    $(event.target)[m
[31m-        .addClass("active")[m
[31m-        .siblings()[m
[31m-        .removeClass("active");[m
[31m-};[m
[31m-[m
[31m-$(() => {[m
[31m-    $(".menu a.item").click(onMenuItemSelected);[m
[31m-    window.socket = io();[m
[31m-});[m
[32m+[m[32mconst onMenuItemSelected = event => {[m[41m[m
[32m+[m[32m    $(event.target)[m[41m[m
[32m+[m[32m        .addClass("active")[m[41m[m
[32m+[m[32m        .siblings()[m[41m[m
[32m+[m[32m        .removeClass("active");[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32m$(() => {[m[41m[m
[32m+[m[32m    $(".menu a.item").click(onMenuItemSelected);[m[41m[m
[32m+[m[32m    window.socket = io();[m[41m[m
[32m+[m[32m});[m[41m[m
[1mdiff --git a/public/js/repository.js b/public/js/repository.js[m
[1mindex 50f77e0..d5724bb 100644[m
[1m--- a/public/js/repository.js[m
[1m+++ b/public/js/repository.js[m
[36m@@ -1,346 +1,346 @@[m
[31m-$(() => {[m
[31m-    getCategories(({ categories }) => {[m
[31m-        categories.forEach(category => {[m
[31m-            addCategory(category.name, category.id);[m
[31m-        });[m
[31m-    });[m
[31m-    const socket = window.socket;[m
[31m-    socket.on("new category", category => {[m
[31m-        addCategory(category.name, category.id);[m
[31m-    });[m
[31m-    socket.on("delete category", category => {[m
[31m-        deleteCategory(category.id);[m
[31m-    });[m
[31m-    socket.on("update categories", category => {[m
[31m-        if (category.name) {[m
[31m-            $("#" + category.id + ".item.category .categoryName").text([m
[31m-                category.name[m
[31m-            );[m
[31m-            const settingsModal = $("#settingsModal");[m
[31m-            if ([m
[31m-                settingsModal.modal("is visible") &&[m
[31m-                settingsModal.currentCategory == category.id[m
[31m-            ) {[m
[31m-                $("#categoryNameSetting").val(category.name);[m
[31m-            }[m
[31m-        }[m
[31m-    });[m
[31m-    socket.on("new material", material => {[m
[31m-        if ($(".item.category.active").attr("id") == material.categorie_id)[m
[31m-            addMaterial(material);[m
[31m-    });[m
[31m-    socket.on("delete material", material => {[m
[31m-        if ($(".item.category.active").attr("id") == material.categorie_id)[m
[31m-            deleteMaterial(material.id);[m
[31m-    });[m
[31m-    socket.on("update material", material => {[m
[31m-        if ($(".item.category.active").attr("id") == material.categorie_id) {[m
[31m-            if (material.quantity) {[m
[31m-                const $quantity = $([m
[31m-                    "#" +[m
[31m-                        material.id +[m
[31m-                        ".material .materialQuantity .quantityValue"[m
[31m-                );[m
[31m-                $quantity.text([m
[31m-                    parseInt($quantity.text()) + parseInt(material.quantity)[m
[31m-                );[m
[31m-                if ([m
[31m-                    $quantity.text() >=[m
[31m-                    $([m
[31m-                        "#" + material.id + ".material .materialMinQuantity"[m
[31m-                    ).text()[m
[31m-                )[m
[31m-                    $("#" + material.id + ".material").removeClass("negative");[m
[31m-                else $("#" + material.id + ".material").addClass("negative");[m
[31m-            }[m
[31m-            if (material.name)[m
[31m-                $("#" + material.id + ".material .materialName").text([m
[31m-                    material.name[m
[31m-                );[m
[31m-[m
[31m-            if (material.format)[m
[31m-                $("#" + material.id + ".material .materialFormat").text([m
[31m-                    material.format[m
[31m-                );[m
[31m-[m
[31m-            if (material.minquantity) {[m
[31m-                $("#" + material.id + ".material .materialMinQuantity").text([m
[31m-                    material.minquantity[m
[31m-                );[m
[31m-                if ([m
[31m-                    $([m
[31m-                        "#" +[m
[31m-                            material.id +[m
[31m-                            ".material .materialQuantity .quantityValue"[m
[31m-                    ).text() <[m
[31m-                    $([m
[31m-                        "#" + material.id + ".material .materialMinQuantity"[m
[31m-                    ).text()[m
[31m-                )[m
[31m-                    $("#" + material.id + ".material").addClass("negative");[m
[31m-                else $("#" + material.id + ".material").removeClass("negative");[m
[31m-            }[m
[31m-        }[m
[31m-    });[m
[31m-});[m
[31m-const deleteMaterial = id => {[m
[31m-    $("#materials #" + id).remove();[m
[31m-};[m
[31m-const deleteCategory = id => {[m
[31m-    $("#categories #" + id).remove();[m
[31m-    $("#materials").html("");[m
[31m-};[m
[31m-const getCategories = cb => {[m
[31m-    $.ajax({[m
[31m-        url: "/api/categories",[m
[31m-        method: "get",[m
[31m-        success: cb[m
[31m-    });[m
[31m-};[m
[31m-const onDeleteMaterial = event => {[m
[31m-    $("#deleteConfirm")[m
[31m-        .modal({[m
[31m-            onApprove: () => {[m
[31m-                $.ajax({[m
[31m-                    url:[m
[31m-                        "/api/materials/" +[m
[31m-                        event.target.parentNode.parentNode.id,[m
[31m-                    method: "delete",[m
[31m-                    data: {[m
[31m-                        categorie_id: $(".item.category.active").attr("id")[m
[31m-                    }[m
[31m-                });[m
[31m-            }[m
[31m-        })[m
[31m-        .modal("show");[m
[31m-};[m
[31m-const updateQuantity = val => {[m
[31m-    const id = $(".material.used").attr("id");[m
[31m-    $.ajax({[m
[31m-        url: "/api/materials/" + id,[m
[31m-        method: "patch",[m
[31m-        data: {[m
[31m-            quantity: val,[m
[31m-            id: id,[m
[31m-            categorie_id: $(".item.category.active").attr("id")[m
[31m-        }[m
[31m-    });[m
[31m-};[m
[31m-const onAmountWillChange = event => {[m
[31m-    if (event.keyCode == 13) {[m
[31m-        updateQuantity([m
[31m-            event.target.id == "amountToAdd"[m
[31m-                ? event.target.value[m
[31m-                : -event.target.value[m
[31m-        );[m
[31m-        const $popup = $([m
[31m-            event.target.id == "amountToAdd"[m
[31m-                ? ".material.used td .addQuantity"[m
[31m-                : ".material.used td .subtractQuantity"[m
[31m-        );[m
[31m-        $popup.popup("hide");[m
[31m-    }[m
[31m-};[m
[31m-const changeActiveMaterial = event => {[m
[31m-    $(event.target.parentNode.parentNode)[m
[31m-        .addClass("used")[m
[31m-        .siblings()[m
[31m-        .removeClass("used");[m
[31m-};[m
[31m-const onMaterialFormatWillChange = event => {[m
[31m-    if (event.keyCode == 13) {[m
[31m-        event.preventDefault();[m
[31m-        event.target.blur();[m
[31m-    }[m
[31m-};[m
[31m-const onMaterialNameWillChange = event => {[m
[31m-    if (event.keyCode == 13 && !event.shiftKey) {[m
[31m-        event.preventDefault();[m
[31m-        event.target.blur();[m
[31m-    }[m
[31m-};[m
[31m-const addMaterial = material => {[m
[31m-    const $row = $(".material.template")[m
[31m-        .clone()[m
[31m-        .removeClass("template")[m
[31m-        .attr("id", material.id);[m
[31m-    if (material.quantity < material.minquantity) $row.addClass("negative");[m
[31m-    $row.find(".materialName").text(material.name);[m
[31m-    $row.find(".materialFormat").text(material.format);[m
[31m-    $row.find(".materialMinQuantity").text(material.minquantity);[m
[31m-    $row.find(".materialQuantity .quantityValue").text(material.quantity);[m
[31m-    $row.find(".materialQuantity .materialMinus").popup({[m
[31m-        popup: $(".ui.popup.subtractQuantityPopup"),[m
[31m-        on: "click",[m
[31m-        onVisible: () => $(".ui.popup.subtractQuantityPopup input").focus(),[m
[31m-        onHidden: () => $(".ui.popup.subtractQuantityPopup input").val("")[m
[31m-    });[m
[31m-    $row.find(".materialQuantity .materialPlus").popup({[m
[31m-        popup: $(".ui.popup.addQuantityPopup"),[m
[31m-        on: "click",[m
[31m-        onVisible: () => $(".ui.popup.addQuantityPopup input").focus(),[m
[31m-        onHidden: () => $(".ui.popup.addQuantityPopup input").val("")[m
[31m-    });[m
[31m-    $("#materials").append($row);[m
[31m-};[m
[31m-const onAddMaterial = event => {[m
[31m-    const id = $(".item.category.active").attr("id");[m
[31m-    $.ajax({[m
[31m-        url: "/api/materials",[m
[31m-        method: "post",[m
[31m-        data: {[m
[31m-            id: id[m
[31m-        }[m
[31m-    });[m
[31m-};[m
[31m-const onFocusCategorySetting = event =>[m
[31m-    (event.target.initialValue = event.target.value);[m
[31m-[m
[31m-const onSaveCategorySetting = () => {[m
[31m-    const categoryNameSetting = $("#categoryNameSetting");[m
[31m-    if (categoryNameSetting[0].initialValue !== categoryNameSetting.val()) {[m
[31m-        $.ajax({[m
[31m-            url: "/api/categories/" + $("#settingsModal")[0].currentCategory,[m
[31m-            method: "patch",[m
[31m-            data: {[m
[31m-                name: categoryNameSetting.val()[m
[31m-            }[m
[31m-        });[m
[31m-    }[m
[31m-    $("#settingsModal").modal("hide");[m
[31m-};[m
[31m-const onMaterialMinQuantityWillChange = event => {[m
[31m-    if (event.keyCode == 13) {[m
[31m-        event.preventDefault();[m
[31m-        if (!isNaN(event.target.innerText) && event.target.innerText >= 0)[m
[31m-            event.target.blur();[m
[31m-    }[m
[31m-};[m
[31m-const handleCategorySelection = category => {[m
[31m-    $.ajax({[m
[31m-        url: "/api/materials/",[m
[31m-        method: "get",[m
[31m-        data: {[m
[31m-            id: category.id[m
[31m-        },[m
[31m-        success: ({ materials }) => {[m
[31m-            $(category)[m
[31m-                .addClass("active")[m
[31m-                .siblings()[m
[31m-                .removeClass("active");[m
[31m-            $("#materials tr")[m
[31m-                .not(".template")[m
[31m-                .remove();[m
[31m-            materials.forEach(addMaterial);[m
[31m-        }[m
[31m-    });[m
[31m-};[m
[31m-[m
[31m-const onBlurMaterial = event => {[m
[31m-    toggleContentEditable(event);[m
[31m-    const parentNode =[m
[31m-        event.target.nodeName === "PRE"[m
[31m-            ? event.target.parentNode.parentNode[m
[31m-            : event.target.parentNode;[m
[31m-    $(parentNode)[m
[31m-        .addClass("used")[m
[31m-        .siblings()[m
[31m-        .removeClass("used");[m
[31m-    const id = parentNode.id;[m
[31m-    const props = {};[m
[31m-    if (event.target.classList.contains("materialName"))[m
[31m-        props.name =[m
[31m-            event.target.innerText == "\n" || event.target.innerText == ""[m
[31m-                ? "Name"[m
[31m-                : event.target.innerText;[m
[31m-    if (event.target.classList.contains("materialFormat"))[m
[31m-        props.format =[m
[31m-            event.target.innerText == "\n" || event.target.innerText == ""[m
[31m-                ? "Format"[m
[31m-                : event.target.innerText;[m
[31m-    if (event.target.classList.contains("materialMinQuantity"))[m
[31m-        props.minquantity =[m
[31m-            event.target.innerText == "\n" || event.target.innerText == ""[m
[31m-                ? 0[m
[31m-                : event.target.innerText;[m
[31m-    $.ajax({[m
[31m-        url: "/api/materials/" + id,[m
[31m-        method: "patch",[m
[31m-        data: {[m
[31m-            id: id,[m
[31m-            categorie_id: $(".category.active").attr("id"),[m
[31m-            ...props[m
[31m-        }[m
[31m-    });[m
[31m-};[m
[31m-[m
[31m-const onCategorySelected = event => {[m
[31m-    handleCategorySelection(event.target.parentNode);[m
[31m-    event.stopPropagation();[m
[31m-};[m
[31m-[m
[31m-const onCategoryMenuItemSelected = event => {[m
[31m-    handleCategorySelection(event.target);[m
[31m-};[m
[31m-const onBlurCategorySetting = event => {};[m
[31m-const onRemoveCategory = event => {[m
[31m-    $("#deleteConfirm")[m
[31m-        .modal({[m
[31m-            onApprove: () => {[m
[31m-                $.ajax({[m
[31m-                    url: "/api/categories/" + event.target.parentNode.id,[m
[31m-                    method: "delete"[m
[31m-                });[m
[31m-            }[m
[31m-        })[m
[31m-        .modal("show");[m
[31m-    event.stopPropagation();[m
[31m-};[m
[31m-const toggleContentEditable = event => {[m
[31m-    const ele = event.target;[m
[31m-    ele.contentEditable = !(ele.contentEditable === "true");[m
[31m-    if (ele.contentEditable === "true") {[m
[31m-        ele.focus();[m
[31m-        window.getSelection().selectAllChildren(ele);[m
[31m-    }[m
[31m-};[m
[31m-const onShowSettings = () => {};[m
[31m-[m
[31m-const onConfigureCategory = event => {[m
[31m-    const category = event.target.parentNode;[m
[31m-    $("#categoryNameSetting").val([m
[31m-        category.querySelector(".categoryName").innerText[m
[31m-    );[m
[31m-    $("#settingsModal")[m
[31m-        .modal({[m
[31m-            onShow: onShowSettings[m
[31m-        })[m
[31m-        .modal("show");[m
[31m-    $("#settingsModal")[0].currentCategory = category.id;[m
[31m-    event.stopPropagation();[m
[31m-};[m
[31m-[m
[31m-const onCategoryNameWillChange = event => {[m
[31m-    if (event.keyCode == 13) {[m
[31m-        event.preventDefault();[m
[31m-        onSaveCategorySetting();[m
[31m-    }[m
[31m-};[m
[31m-const onAddCategory = event => {[m
[31m-    const defaultName = "Unbekannt";[m
[31m-    $.ajax({[m
[31m-        url: "/api/categories",[m
[31m-        method: "post",[m
[31m-        data: {[m
[31m-            name: defaultName[m
[31m-        }[m
[31m-    });[m
[31m-};[m
[31m-const addCategory = (name, id) => {[m
[31m-    let $category = $(".category.template")[m
[31m-        .clone()[m
[31m-        .removeClass("template")[m
[31m-        .attr("id", id);[m
[31m-    $category.find(".categoryName").text(name);[m
[31m-    $("#categories").append($category);[m
[31m-};[m
[32m+[m[32m$(() => {[m[41m[m
[32m+[m[32m    getCategories(({ categories }) => {[m[41m[m
[32m+[m[32m        categories.forEach(category => {[m[41m[m
[32m+[m[32m            addCategory(category.name, category.id);[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    const socket = window.socket;[m[41m[m
[32m+[m[32m    socket.on("new category", category => {[m[41m[m
[32m+[m[32m        addCategory(category.name, category.id);[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    socket.on("delete category", category => {[m[41m[m
[32m+[m[32m        deleteCategory(category.id);[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    socket.on("update categories", category => {[m[41m[m
[32m+[m[32m        if (category.name) {[m[41m[m
[32m+[m[32m            $("#" + category.id + ".item.category .categoryName").text([m[41m[m
[32m+[m[32m                category.name[m[41m[m
[32m+[m[32m            );[m[41m[m
[32m+[m[32m            const settingsModal = $("#settingsModal");[m[41m[m
[32m+[m[32m            if ([m[41m[m
[32m+[m[32m                settingsModal.modal("is visible") &&[m[41m[m
[32m+[m[32m                settingsModal.currentCategory == category.id[m[41m[m
[32m+[m[32m            ) {[m[41m[m
[32m+[m[32m                $("#categoryNameSetting").val(category.name);[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    socket.on("new material", material => {[m[41m[m
[32m+[m[32m        if ($(".item.category.active").attr("id") == material.categorie_id)[m[41m[m
[32m+[m[32m            addMaterial(material);[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    socket.on("delete material", material => {[m[41m[m
[32m+[m[32m        if ($(".item.category.active").attr("id") == material.categorie_id)[m[41m[m
[32m+[m[32m            deleteMaterial(material.id);[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    socket.on("update material", material => {[m[41m[m
[32m+[m[32m        if ($(".item.category.active").attr("id") == material.categorie_id) {[m[41m[m
[32m+[m[32m            if (material.quantity) {[m[41m[m
[32m+[m[32m                const $quantity = $([m[41m[m
[32m+[m[32m                    "#" +[m[41m[m
[32m+[m[32m                        material.id +[m[41m[m
[32m+[m[32m                        ".material .materialQuantity .quantityValue"[m[41m[m
[32m+[m[32m                );[m[41m[m
[32m+[m[32m                $quantity.text([m[41m[m
[32m+[m[32m                    parseInt($quantity.text()) + parseInt(material.quantity)[m[41m[m
[32m+[m[32m                );[m[41m[m
[32m+[m[32m                if ([m[41m[m
[32m+[m[32m                    $quantity.text() >=[m[41m[m
[32m+[m[32m                    $([m[41m[m
[32m+[m[32m                        "#" + material.id + ".material .materialMinQuantity"[m[41m[m
[32m+[m[32m                    ).text()[m[41m[m
[32m+[m[32m                )[m[41m[m
[32m+[m[32m                    $("#" + material.id + ".material").removeClass("negative");[m[41m[m
[32m+[m[32m                else $("#" + material.id + ".material").addClass("negative");[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m            if (material.name)[m[41m[m
[32m+[m[32m                $("#" + material.id + ".material .materialName").text([m[41m[m
[32m+[m[32m                    material.name[m[41m[m
[32m+[m[32m                );[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            if (material.format)[m[41m[m
[32m+[m[32m                $("#" + material.id + ".material .materialFormat").text([m[41m[m
[32m+[m[32m                    material.format[m[41m[m
[32m+[m[32m                );[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            if (material.minquantity) {[m[41m[m
[32m+[m[32m                $("#" + material.id + ".material .materialMinQuantity").text([m[41m[m
[32m+[m[32m                    material.minquantity[m[41m[m
[32m+[m[32m                );[m[41m[m
[32m+[m[32m                if ([m[41m[m
[32m+[m[32m                    $([m[41m[m
[32m+[m[32m                        "#" +[m[41m[m
[32m+[m[32m                            material.id +[m[41m[m
[32m+[m[32m                            ".material .materialQuantity .quantityValue"[m[41m[m
[32m+[m[32m                    ).text() <[m[41m[m
[32m+[m[32m                    $([m[41m[m
[32m+[m[32m                        "#" + material.id + ".material .materialMinQuantity"[m[41m[m
[32m+[m[32m                    ).text()[m[41m[m
[32m+[m[32m                )[m[41m[m
[32m+[m[32m                    $("#" + material.id + ".material").addClass("negative");[m[41m[m
[32m+[m[32m                else $("#" + material.id + ".material").removeClass("negative");[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m});[m[41m[m
[32m+[m[32mconst deleteMaterial = id => {[m[41m[m
[32m+[m[32m    $("#materials #" + id).remove();[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst deleteCategory = id => {[m[41m[m
[32m+[m[32m    $("#categories #" + id).remove();[m[41m[m
[32m+[m[32m    $("#materials").html("");[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst getCategories = cb => {[m[41m[m
[32m+[m[32m    $.ajax({[m[41m[m
[32m+[m[32m        url: "/api/categories",[m[41m[m
[32m+[m[32m        method: "get",[m[41m[m
[32m+[m[32m        success: cb[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onDeleteMaterial = event => {[m[41m[m
[32m+[m[32m    $("#deleteConfirm")[m[41m[m
[32m+[m[32m        .modal({[m[41m[m
[32m+[m[32m            onApprove: () => {[m[41m[m
[32m+[m[32m                $.ajax({[m[41m[m
[32m+[m[32m                    url:[m[41m[m
[32m+[m[32m                        "/api/materials/" +[m[41m[m
[32m+[m[32m                        event.target.parentNode.parentNode.id,[m[41m[m
[32m+[m[32m                    method: "delete",[m[41m[m
[32m+[m[32m                    data: {[m[41m[m
[32m+[m[32m                        categorie_id: $(".item.category.active").attr("id")[m[41m[m
[32m+[m[32m                    }[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        })[m[41m[m
[32m+[m[32m        .modal("show");[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst updateQuantity = val => {[m[41m[m
[32m+[m[32m    const id = $(".material.used").attr("id");[m[41m[m
[32m+[m[32m    $.ajax({[m[41m[m
[32m+[m[32m        url: "/api/materials/" + id,[m[41m[m
[32m+[m[32m        method: "patch",[m[41m[m
[32m+[m[32m        data: {[m[41m[m
[32m+[m[32m            quantity: val,[m[41m[m
[32m+[m[32m            id: id,[m[41m[m
[32m+[m[32m            categorie_id: $(".item.category.active").attr("id")[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onAmountWillChange = event => {[m[41m[m
[32m+[m[32m    if (event.keyCode == 13) {[m[41m[m
[32m+[m[32m        updateQuantity([m[41m[m
[32m+[m[32m            event.target.id == "amountToAdd"[m[41m[m
[32m+[m[32m                ? event.target.value[m[41m[m
[32m+[m[32m                : -event.target.value[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m        const $popup = $([m[41m[m
[32m+[m[32m            event.target.id == "amountToAdd"[m[41m[m
[32m+[m[32m                ? ".material.used td .addQuantity"[m[41m[m
[32m+[m[32m                : ".material.used td .subtractQuantity"[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m        $popup.popup("hide");[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst changeActiveMaterial = event => {[m[41m[m
[32m+[m[32m    $(event.target.parentNode.parentNode)[m[41m[m
[32m+[m[32m        .addClass("used")[m[41m[m
[32m+[m[32m        .siblings()[m[41m[m
[32m+[m[32m        .removeClass("used");[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onMaterialFormatWillChange = event => {[m[41m[m
[32m+[m[32m    if (event.keyCode == 13) {[m[41m[m
[32m+[m[32m        event.preventDefault();[m[41m[m
[32m+[m[32m        event.target.blur();[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onMaterialNameWillChange = event => {[m[41m[m
[32m+[m[32m    if (event.keyCode == 13 && !event.shiftKey) {[m[41m[m
[32m+[m[32m        event.preventDefault();[m[41m[m
[32m+[m[32m        event.target.blur();[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst addMaterial = material => {[m[41m[m
[32m+[m[32m    const $row = $(".material.template")[m[41m[m
[32m+[m[32m        .clone()[m[41m[m
[32m+[m[32m        .removeClass("template")[m[41m[m
[32m+[m[32m        .attr("id", material.id);[m[41m[m
[32m+[m[32m    if (material.quantity < material.minquantity) $row.addClass("negative");[m[41m[m
[32m+[m[32m    $row.find(".materialName").text(material.name);[m[41m[m
[32m+[m[32m    $row.find(".materialFormat").text(material.format);[m[41m[m
[32m+[m[32m    $row.find(".materialMinQuantity").text(material.minquantity);[m[41m[m
[32m+[m[32m    $row.find(".materialQuantity .quantityValue").text(material.quantity);[m[41m[m
[32m+[m[32m    $row.find(".materialQuantity .materialMinus").popup({[m[41m[m
[32m+[m[32m        popup: $(".ui.popup.subtractQuantityPopup"),[m[41m[m
[32m+[m[32m        on: "click",[m[41m[m
[32m+[m[32m        onVisible: () => $(".ui.popup.subtractQuantityPopup input").focus(),[m[41m[m
[32m+[m[32m        onHidden: () => $(".ui.popup.subtractQuantityPopup input").val("")[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    $row.find(".materialQuantity .materialPlus").popup({[m[41m[m
[32m+[m[32m        popup: $(".ui.popup.addQuantityPopup"),[m[41m[m
[32m+[m[32m        on: "click",[m[41m[m
[32m+[m[32m        onVisible: () => $(".ui.popup.addQuantityPopup input").focus(),[m[41m[m
[32m+[m[32m        onHidden: () => $(".ui.popup.addQuantityPopup input").val("")[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m    $("#materials").append($row);[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onAddMaterial = event => {[m[41m[m
[32m+[m[32m    const id = $(".item.category.active").attr("id");[m[41m[m
[32m+[m[32m    $.ajax({[m[41m[m
[32m+[m[32m        url: "/api/materials",[m[41m[m
[32m+[m[32m        method: "post",[m[41m[m
[32m+[m[32m        data: {[m[41m[m
[32m+[m[32m            id: id[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onFocusCategorySetting = event =>[m[41m[m
[32m+[m[32m    (event.target.initialValue = event.target.value);[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst onSaveCategorySetting = () => {[m[41m[m
[32m+[m[32m    const categoryNameSetting = $("#categoryNameSetting");[m[41m[m
[32m+[m[32m    if (categoryNameSetting[0].initialValue !== categoryNameSetting.val()) {[m[41m[m
[32m+[m[32m        $.ajax({[m[41m[m
[32m+[m[32m            url: "/api/categories/" + $("#settingsModal")[0].currentCategory,[m[41m[m
[32m+[m[32m            method: "patch",[m[41m[m
[32m+[m[32m            data: {[m[41m[m
[32m+[m[32m                name: categoryNameSetting.val()[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m    $("#settingsModal").modal("hide");[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onMaterialMinQuantityWillChange = event => {[m[41m[m
[32m+[m[32m    if (event.keyCode == 13) {[m[41m[m
[32m+[m[32m        event.preventDefault();[m[41m[m
[32m+[m[32m        if (!isNaN(event.target.innerText) && event.target.innerText >= 0)[m[41m[m
[32m+[m[32m            event.target.blur();[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst handleCategorySelection = category => {[m[41m[m
[32m+[m[32m    $.ajax({[m[41m[m
[32m+[m[32m        url: "/api/materials/",[m[41m[m
[32m+[m[32m        method: "get",[m[41m[m
[32m+[m[32m        data: {[m[41m[m
[32m+[m[32m            id: category.id[m[41m[m
[32m+[m[32m        },[m[41m[m
[32m+[m[32m        success: ({ materials }) => {[m[41m[m
[32m+[m[32m            $(category)[m[41m[m
[32m+[m[32m                .addClass("active")[m[41m[m
[32m+[m[32m                .siblings()[m[41m[m
[32m+[m[32m                .removeClass("active");[m[41m[m
[32m+[m[32m            $("#materials tr")[m[41m[m
[32m+[m[32m                .not(".template")[m[41m[m
[32m+[m[32m                .remove();[m[41m[m
[32m+[m[32m            materials.forEach(addMaterial);[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst onBlurMaterial = event => {[m[41m[m
[32m+[m[32m    toggleContentEditable(event);[m[41m[m
[32m+[m[32m    const parentNode =[m[41m[m
[32m+[m[32m        event.target.nodeName === "PRE"[m[41m[m
[32m+[m[32m            ? event.target.parentNode.parentNode[m[41m[m
[32m+[m[32m            : event.target.parentNode;[m[41m[m
[32m+[m[32m    $(parentNode)[m[41m[m
[32m+[m[32m        .addClass("used")[m[41m[m
[32m+[m[32m        .siblings()[m[41m[m
[32m+[m[32m        .removeClass("used");[m[41m[m
[32m+[m[32m    const id = parentNode.id;[m[41m[m
[32m+[m[32m    const props = {};[m[41m[m
[32m+[m[32m    if (event.target.classList.contains("materialName"))[m[41m[m
[32m+[m[32m        props.name =[m[41m[m
[32m+[m[32m            event.target.innerText == "\n" || event.target.innerText == ""[m[41m[m
[32m+[m[32m                ? "Name"[m[41m[m
[32m+[m[32m                : event.target.innerText;[m[41m[m
[32m+[m[32m    if (event.target.classList.contains("materialFormat"))[m[41m[m
[32m+[m[32m        props.format =[m[41m[m
[32m+[m[32m            event.target.innerText == "\n" || event.target.innerText == ""[m[41m[m
[32m+[m[32m                ? "Format"[m[41m[m
[32m+[m[32m                : event.target.innerText;[m[41m[m
[32m+[m[32m    if (event.target.classList.contains("materialMinQuantity"))[m[41m[m
[32m+[m[32m        props.minquantity =[m[41m[m
[32m+[m[32m            event.target.innerText == "\n" || event.target.innerText == ""[m[41m[m
[32m+[m[32m                ? 0[m[41m[m
[32m+[m[32m                : event.target.innerText;[m[41m[m
[32m+[m[32m    $.ajax({[m[41m[m
[32m+[m[32m        url: "/api/materials/" + id,[m[41m[m
[32m+[m[32m        method: "patch",[m[41m[m
[32m+[m[32m        data: {[m[41m[m
[32m+[m[32m            id: id,[m[41m[m
[32m+[m[32m            categorie_id: $(".category.active").attr("id"),[m[41m[m
[32m+[m[32m            ...props[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst onCategorySelected = event => {[m[41m[m
[32m+[m[32m    handleCategorySelection(event.target.parentNode);[m[41m[m
[32m+[m[32m    event.stopPropagation();[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst onCategoryMenuItemSelected = event => {[m[41m[m
[32m+[m[32m    handleCategorySelection(event.target);[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onBlurCategorySetting = event => {};[m[41m[m
[32m+[m[32mconst onRemoveCategory = event => {[m[41m[m
[32m+[m[32m    $("#deleteConfirm")[m[41m[m
[32m+[m[32m        .modal({[m[41m[m
[32m+[m[32m            onApprove: () => {[m[41m[m
[32m+[m[32m                $.ajax({[m[41m[m
[32m+[m[32m                    url: "/api/categories/" + event.target.parentNode.id,[m[41m[m
[32m+[m[32m                    method: "delete"[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        })[m[41m[m
[32m+[m[32m        .modal("show");[m[41m[m
[32m+[m[32m    event.stopPropagation();[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst toggleContentEditable = event => {[m[41m[m
[32m+[m[32m    const ele = event.target;[m[41m[m
[32m+[m[32m    ele.contentEditable = !(ele.contentEditable === "true");[m[41m[m
[32m+[m[32m    if (ele.contentEditable === "true") {[m[41m[m
[32m+[m[32m        ele.focus();[m[41m[m
[32m+[m[32m        window.getSelection().selectAllChildren(ele);[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onShowSettings = () => {};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst onConfigureCategory = event => {[m[41m[m
[32m+[m[32m    const category = event.target.parentNode;[m[41m[m
[32m+[m[32m    $("#categoryNameSetting").val([m[41m[m
[32m+[m[32m        category.querySelector(".categoryName").innerText[m[41m[m
[32m+[m[32m    );[m[41m[m
[32m+[m[32m    $("#settingsModal")[m[41m[m
[32m+[m[32m        .modal({[m[41m[m
[32m+[m[32m            onShow: onShowSettings[m[41m[m
[32m+[m[32m        })[m[41m[m
[32m+[m[32m        .modal("show");[m[41m[m
[32m+[m[32m    $("#settingsModal")[0].currentCategory = category.id;[m[41m[m
[32m+[m[32m    event.stopPropagation();[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst onCategoryNameWillChange = event => {[m[41m[m
[32m+[m[32m    if (event.keyCode == 13) {[m[41m[m
[32m+[m[32m        event.preventDefault();[m[41m[m
[32m+[m[32m        onSaveCategorySetting();[m[41m[m
[32m+[m[32m    }[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst onAddCategory = event => {[m[41m[m
[32m+[m[32m    const defaultName = "Unbekannt";[m[41m[m
[32m+[m[32m    $.ajax({[m[41m[m
[32m+[m[32m        url: "/api/categories",[m[41m[m
[32m+[m[32m        method: "post",[m[41m[m
[32m+[m[32m        data: {[m[41m[m
[32m+[m[32m            name: defaultName[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32m};[m[41m[m
[32m+[m[32mconst addCategory = (name, id) => {[m[41m[m
[32m+[m[32m    let $category = $(".category.template")[m[41m[m
[32m+[m[32m        .clone()[m[41m[m
[32m+[m[32m        .removeClass("template")[m[41m[m
[32m+[m[32m        .attr("id", id);[m[41m[m
[32m+[m[32m    $category.find(".categoryName").text(name);[m[41m[m
[32m+[m[32m    $("#categories").append($category);[m[41m[m
[32m+[m[32m};[m[41m[m
[1mdiff --git a/public/js/sortable.js b/public/js/sortable.js[m
[1mindex 79e0a3b..561ebfe 100644[m
[1m--- a/public/js/sortable.js[m
[1m+++ b/public/js/sortable.js[m
[36m@@ -1,152 +1,152 @@[m
[31m-/*[m
[31m-	A simple, lightweight jQuery plugin for creating sortable tables.[m
[31m-	https://github.com/kylefox/jquery-tablesort[m
[31m-	Version 0.0.11[m
[31m-*/[m
[31m-[m
[31m-(function($) {[m
[31m-    $.tablesort = function($table, settings) {[m
[31m-        var self = this;[m
[31m-        this.$table = $table;[m
[31m-        this.$thead = this.$table.find("thead");[m
[31m-        this.settings = $.extend({}, $.tablesort.defaults, settings);[m
[31m-        this.$sortCells =[m
[31m-            this.$thead.length > 0[m
[31m-                ? this.$thead.find("th:not(.no-sort)")[m
[31m-                : this.$table.find("th:not(.no-sort)");[m
[31m-        this.$sortCells.on("click.tablesort", function() {[m
[31m-            self.sort($(this));[m
[31m-        });[m
[31m-        this.index = null;[m
[31m-        this.$th = null;[m
[31m-        this.direction = null;[m
[31m-    };[m
[31m-[m
[31m-    $.tablesort.prototype = {[m
[31m-        sort: function(th, direction) {[m
[31m-            var start = new Date(),[m
[31m-                self = this,[m
[31m-                table = this.$table,[m
[31m-                rowsContainer =[m
[31m-                    table.find("tbody").length > 0[m
[31m-                        ? table.find("tbody")[m
[31m-                        : table,[m
[31m-                rows = rowsContainer.find("tr").has("td, th"),[m
[31m-                cells = rows[m
[31m-                    .find(":nth-child(" + (th.index() + 1) + ")")[m
[31m-                    .filter("td, th"),[m
[31m-                sortBy = th.data().sortBy,[m
[31m-                sortedMap = [];[m
[31m-[m
[31m-            var unsortedValues = cells.map(function(idx, cell) {[m
[31m-                if (sortBy)[m
[31m-                    return typeof sortBy === "function"[m
[31m-                        ? sortBy($(th), $(cell), self)[m
[31m-                        : sortBy;[m
[31m-                return $(this).data().sortValue != null[m
[31m-                    ? $(this).data().sortValue[m
[31m-                    : $(this).text();[m
[31m-            });[m
[31m-            if (unsortedValues.length === 0) return;[m
[31m-[m
[31m-            //click on a different column[m
[31m-            if (this.index !== th.index()) {[m
[31m-                this.direction = "asc";[m
[31m-                this.index = th.index();[m
[31m-            } else if (direction !== "asc" && direction !== "desc")[m
[31m-                this.direction = this.direction === "asc" ? "desc" : "asc";[m
[31m-            else this.direction = direction;[m
[31m-[m
[31m-            direction = this.direction == "asc" ? 1 : -1;[m
[31m-[m
[31m-            self.$table.trigger("tablesort:start", [self]);[m
[31m-            self.log("Sorting by " + this.index + " " + this.direction);[m
[31m-[m
[31m-            // Try to force a browser redraw[m
[31m-            self.$table.css("display");[m
[31m-            // Run sorting asynchronously on a timeout to force browser redraw after[m
[31m-            // `tablesort:start` callback. Also avoids locking up the browser too much.[m
[31m-            setTimeout(function() {[m
[31m-                self.$sortCells.removeClass([m
[31m-                    self.settings.asc + " " + self.settings.desc[m
[31m-                );[m
[31m-                for ([m
[31m-                    var i = 0, length = unsortedValues.length;[m
[31m-                    i < length;[m
[31m-                    i++[m
[31m-                ) {[m
[31m-                    sortedMap.push({[m
[31m-                        index: i,[m
[31m-                        cell: cells[i],[m
[31m-                        row: rows[i],[m
[31m-                        value: unsortedValues[i][m
[31m-                    });[m
[31m-                }[m
[31m-[m
[31m-                sortedMap.sort(function(a, b) {[m
[31m-                    return self.settings.compare(a.value, b.value) * direction;[m
[31m-                });[m
[31m-[m
[31m-                $.each(sortedMap, function(i, entry) {[m
[31m-                    rowsContainer.append(entry.row);[m
[31m-                });[m
[31m-[m
[31m-                th.addClass(self.settings[self.direction]);[m
[31m-[m
[31m-                self.log([m
[31m-                    "Sort finished in " +[m
[31m-                        (new Date().getTime() - start.getTime()) +[m
[31m-                        "ms"[m
[31m-                );[m
[31m-                self.$table.trigger("tablesort:complete", [self]);[m
[31m-                //Try to force a browser redraw[m
[31m-                self.$table.css("display");[m
[31m-            }, unsortedValues.length > 2000 ? 200 : 10);[m
[31m-        },[m
[31m-[m
[31m-        log: function(msg) {[m
[31m-            if ([m
[31m-                ($.tablesort.DEBUG || this.settings.debug) &&[m
[31m-                console &&[m
[31m-                console.log[m
[31m-            ) {[m
[31m-                console.log("[tablesort] " + msg);[m
[31m-            }[m
[31m-        },[m
[31m-[m
[31m-        destroy: function() {[m
[31m-            this.$sortCells.off("click.tablesort");[m
[31m-            this.$table.data("tablesort", null);[m
[31m-            return null;[m
[31m-        }[m
[31m-    };[m
[31m-[m
[31m-    $.tablesort.DEBUG = false;[m
[31m-[m
[31m-    $.tablesort.defaults = {[m
[31m-        debug: $.tablesort.DEBUG,[m
[31m-        asc: "sorted ascending",[m
[31m-        desc: "sorted descending",[m
[31m-        compare: function(a, b) {[m
[31m-            if (a > b) {[m
[31m-                return 1;[m
[31m-            } else if (a < b) {[m
[31m-                return -1;[m
[31m-            } else {[m
[31m-                return 0;[m
[31m-            }[m
[31m-        }[m
[31m-    };[m
[31m-[m
[31m-    $.fn.tablesort = function(settings) {[m
[31m-        var table, sortable, previous;[m
[31m-        return this.each(function() {[m
[31m-            table = $(this);[m
[31m-            previous = table.data("tablesort");[m
[31m-            if (previous) {[m
[31m-                previous.destroy();[m
[31m-            }[m
[31m-            table.data("tablesort", new $.tablesort(table, settings));[m
[31m-        });[m
[31m-    };[m
[31m-})(window.Zepto || window.jQuery);[m
[32m+[m[32m/*[m[41m[m
[32m+[m	[32mA simple, lightweight jQuery plugin for creating sortable tables.[m[41m[m
[32m+[m	[32mhttps://github.com/kylefox/jquery-tablesort[m[41m[m
[32m+[m	[32mVersion 0.0.11[m[41m[m
[32m+[m[32m*/[m[41m[m
[32m+[m[41m[m
[32m+[m[32m(function($) {[m[41m[m
[32m+[m[32m    $.tablesort = function($table, settings) {[m[41m[m
[32m+[m[32m        var self = this;[m[41m[m
[32m+[m[32m        this.$table = $table;[m[41m[m
[32m+[m[32m        this.$thead = this.$table.find("thead");[m[41m[m
[32m+[m[32m        this.settings = $.extend({}, $.tablesort.defaults, settings);[m[41m[m
[32m+[m[32m        this.$sortCells =[m[41m[m
[32m+[m[32m            this.$thead.length > 0[m[41m[m
[32m+[m[32m                ? this.$thead.find("th:not(.no-sort)")[m[41m[m
[32m+[m[32m                : this.$table.find("th:not(.no-sort)");[m[41m[m
[32m+[m[32m        this.$sortCells.on("click.tablesort", function() {[m[41m[m
[32m+[m[32m            self.sort($(this));[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m        this.index = null;[m[41m[m
[32m+[m[32m        this.$th = null;[m[41m[m
[32m+[m[32m        this.direction = null;[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    $.tablesort.prototype = {[m[41m[m
[32m+[m[32m        sort: function(th, direction) {[m[41m[m
[32m+[m[32m            var start = new Date(),[m[41m[m
[32m+[m[32m                self = this,[m[41m[m
[32m+[m[32m                table = this.$table,[m[41m[m
[32m+[m[32m                rowsContainer =[m[41m[m
[32m+[m[32m                    table.find("tbody").length > 0[m[41m[m
[32m+[m[32m                        ? table.find("tbody")[m[41m[m
[32m+[m[32m                        : table,[m[41m[m
[32m+[m[32m                rows = rowsContainer.find("tr").has("td, th"),[m[41m[m
[32m+[m[32m                cells = rows[m[41m[m
[32m+[m[32m                    .find(":nth-child(" + (th.index() + 1) + ")")[m[41m[m
[32m+[m[32m                    .filter("td, th"),[m[41m[m
[32m+[m[32m                sortBy = th.data().sortBy,[m[41m[m
[32m+[m[32m                sortedMap = [];[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            var unsortedValues = cells.map(function(idx, cell) {[m[41m[m
[32m+[m[32m                if (sortBy)[m[41m[m
[32m+[m[32m                    return typeof sortBy === "function"[m[41m[m
[32m+[m[32m                        ? sortBy($(th), $(cell), self)[m[41m[m
[32m+[m[32m                        : sortBy;[m[41m[m
[32m+[m[32m                return $(this).data().sortValue != null[m[41m[m
[32m+[m[32m                    ? $(this).data().sortValue[m[41m[m
[32m+[m[32m                    : $(this).text();[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[32m            if (unsortedValues.length === 0) return;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            //click on a different column[m[41m[m
[32m+[m[32m            if (this.index !== th.index()) {[m[41m[m
[32m+[m[32m                this.direction = "asc";[m[41m[m
[32m+[m[32m                this.index = th.index();[m[41m[m
[32m+[m[32m            } else if (direction !== "asc" && direction !== "desc")[m[41m[m
[32m+[m[32m                this.direction = this.direction === "asc" ? "desc" : "asc";[m[41m[m
[32m+[m[32m            else this.direction = direction;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            direction = this.direction == "asc" ? 1 : -1;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            self.$table.trigger("tablesort:start", [self]);[m[41m[m
[32m+[m[32m            self.log("Sorting by " + this.index + " " + this.direction);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m            // Try to force a browser redraw[m[41m[m
[32m+[m[32m            self.$table.css("display");[m[41m[m
[32m+[m[32m            // Run sorting asynchronously on a timeout to force browser redraw after[m[41m[m
[32m+[m[32m            // `tablesort:start` callback. Also avoids locking up the browser too much.[m[41m[m
[32m+[m[32m            setTimeout(function() {[m[41m[m
[32m+[m[32m                self.$sortCells.removeClass([m[41m[m
[32m+[m[32m                    self.settings.asc + " " + self.settings.desc[m[41m[m
[32m+[m[32m                );[m[41m[m
[32m+[m[32m                for ([m[41m[m
[32m+[m[32m                    var i = 0, length = unsortedValues.length;[m[41m[m
[32m+[m[32m                    i < length;[m[41m[m
[32m+[m[32m                    i++[m[41m[m
[32m+[m[32m                ) {[m[41m[m
[32m+[m[32m                    sortedMap.push({[m[41m[m
[32m+[m[32m                        index: i,[m[41m[m
[32m+[m[32m                        cell: cells[i],[m[41m[m
[32m+[m[32m                        row: rows[i],[m[41m[m
[32m+[m[32m                        value: unsortedValues[i][m[41m[m
[32m+[m[32m                    });[m[41m[m
[32m+[m[32m                }[m[41m[m
[32m+[m[41m[m
[32m+[m[32m                sortedMap.sort(function(a, b) {[m[41m[m
[32m+[m[32m                    return self.settings.compare(a.value, b.value) * direction;[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m                $.each(sortedMap, function(i, entry) {[m[41m[m
[32m+[m[32m                    rowsContainer.append(entry.row);[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[41m[m
[32m+[m[32m                th.addClass(self.settings[self.direction]);[m[41m[m
[32m+[m[41m[m
[32m+[m[32m                self.log([m[41m[m
[32m+[m[32m                    "Sort finished in " +[m[41m[m
[32m+[m[32m                        (new Date().getTime() - start.getTime()) +[m[41m[m
[32m+[m[32m                        "ms"[m[41m[m
[32m+[m[32m                );[m[41m[m
[32m+[m[32m                self.$table.trigger("tablesort:complete", [self]);[m[41m[m
[32m+[m[32m                //Try to force a browser redraw[m[41m[m
[32m+[m[32m                self.$table.css("display");[m[41m[m
[32m+[m[32m            }, unsortedValues.length > 2000 ? 200 : 10);[m[41m[m
[32m+[m[32m        },[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        log: function(msg) {[m[41m[m
[32m+[m[32m            if ([m[41m[m
[32m+[m[32m                ($.tablesort.DEBUG || this.settings.debug) &&[m[41m[m
[32m+[m[32m                console &&[m[41m[m
[32m+[m[32m                console.log[m[41m[m
[32m+[m[32m            ) {[m[41m[m
[32m+[m[32m                console.log("[tablesort] " + msg);[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        },[m[41m[m
[32m+[m[41m[m
[32m+[m[32m        destroy: function() {[m[41m[m
[32m+[m[32m            this.$sortCells.off("click.tablesort");[m[41m[m
[32m+[m[32m            this.$table.data("tablesort", null);[m[41m[m
[32m+[m[32m            return null;[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    $.tablesort.DEBUG = false;[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    $.tablesort.defaults = {[m[41m[m
[32m+[m[32m        debug: $.tablesort.DEBUG,[m[41m[m
[32m+[m[32m        asc: "sorted ascending",[m[41m[m
[32m+[m[32m        desc: "sorted descending",[m[41m[m
[32m+[m[32m        compare: function(a, b) {[m[41m[m
[32m+[m[32m            if (a > b) {[m[41m[m
[32m+[m[32m                return 1;[m[41m[m
[32m+[m[32m            } else if (a < b) {[m[41m[m
[32m+[m[32m                return -1;[m[41m[m
[32m+[m[32m            } else {[m[41m[m
[32m+[m[32m                return 0;[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[41m[m
[32m+[m[32m    $.fn.tablesort = function(settings) {[m[41m[m
[32m+[m[32m        var table, sortable, previous;[m[41m[m
[32m+[m[32m        return this.each(function() {[m[41m[m
[32m+[m[32m            table = $(this);[m[41m[m
[32m+[m[32m            previous = table.data("tablesort");[m[41m[m
[32m+[m[32m            if (previous) {[m[41m[m
[32m+[m[32m                previous.destroy();[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m            table.data("tablesort", new $.tablesort(table, settings));[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m    };[m[41m[m
[32m+[m[32m})(window.Zepto || window.jQuery);[m[41m[m
[1mdiff --git a/routes/api/categoriesRouter.js b/routes/api/categoriesRouter.js[m
[1mindex 44216e3..576e36d 100644[m
[1m--- a/routes/api/categoriesRouter.js[m
[1m+++ b/routes/api/categoriesRouter.js[m
[36m@@ -1,63 +1,63 @@[m
[31m-import express from "express";[m
[31m-[m
[31m-const router = express.Router();[m
[31m-[m
[31m-router[m
[31m-    .route("/")[m
[31m-    .get((req, res) => {[m
[31m-        connection.query("select * from categories", (err, result) => {[m
[31m-            if (err) console.error(err);[m
[31m-            res.json({[m
[31m-                categories: result[m
[31m-            });[m
[31m-        });[m
[31m-    })[m
[31m-    .post((req, res) => {[m
[31m-        const data = [req.body.name].map(val => "'" + val + "'").join(", ");[m
[31m-        connection.query([m
[31m-            "insert into categories values(0, " + data + ")",[m
[31m-            (err, result) => {[m
[31m-                if (err) console.log(err);[m
[31m-                io.emit("new category", {[m
[31m-                    name: req.body.name,[m
[31m-                    id: result.insertId[m
[31m-                });[m
[31m-                res.json({[m
[31m-                    message: "ok"[m
[31m-                });[m
[31m-            }[m
[31m-        );[m
[31m-    });[m
[31m-[m
[31m-router[m
[31m-    .route("/:id")[m
[31m-    .delete((req, res) => {[m
[31m-        connection.query([m
[31m-            "delete from categories where id=" + req.params.id,[m
[31m-            (err, result) => {[m
[31m-                if (err) console.log(err);[m
[31m-                io.emit("delete category", {[m
[31m-                    id: req.params.id[m
[31m-                });[m
[31m-                res.json({[m
[31m-                    message: "ok"[m
[31m-                });[m
[31m-            }[m
[31m-        );[m
[31m-    })[m
[31m-    .patch((req, res) => {[m
[31m-        let set = "set ";[m
[31m-        if (req.body.name) set += "name='" + req.body.name + "' ";[m
[31m-        if (set !== "set ")[m
[31m-            connection.query([m
[31m-                "update categories " + set + "where id=" + req.params.id,[m
[31m-                (err, result) => {[m
[31m-                    if (err) console.error(err);[m
[31m-                    req.body.id = req.params.id;[m
[31m-                    io.emit("update categories", req.body);[m
[31m-                    res.json({});[m
[31m-                }[m
[31m-            );[m
[31m-    });[m
[31m-[m
[31m-export default router;[m
[32m+[m[32mimport express from "express";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst router = express.Router();[m[41m[m
[32m+[m[41m[m
[32m+[m[32mrouter[m[41m[m
[32m+[m[32m    .route("/")[m[41m[m
[32m+[m[32m    .get((req, res) => {[m[41m[m
[32m+[m[32m        connection.query("select * from categories", (err, result) => {[m[41m[m
[32m+[m[32m            if (err) console.error(err);[m[41m[m
[32m+[m[32m            res.json({[m[41m[m
[32m+[m[32m                categories: result[m[41m[m
[32m+[m[32m            });[m[41m[m
[32m+[m[32m        });[m[41m[m
[32m+[m[32m    })[m[41m[m
[32m+[m[32m    .post((req, res) => {[m[41m[m
[32m+[m[32m        const data = [req.body.name].map(val => "'" + val + "'").join(", ");[m[41m[m
[32m+[m[32m        connection.query([m[41m[m
[32m+[m[32m            "insert into categories values(0, " + data + ")",[m[41m[m
[32m+[m[32m            (err, result) => {[m[41m[m
[32m+[m[32m                if (err) console.log(err);[m[41m[m
[32m+[m[32m                io.emit("new category", {[m[41m[m
[32m+[m[32m                    name: req.body.name,[m[41m[m
[32m+[m[32m                    id: result.insertId[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m                res.json({[m[41m[m
[32m+[m[32m                    message: "ok"[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[41m[m
[32m+[m[32mrouter[m[41m[m
[32m+[m[32m    .route("/:id")[m[41m[m
[32m+[m[32m    .delete((req, res) => {[m[41m[m
[32m+[m[32m        connection.query([m[41m[m
[32m+[m[32m            "delete from categories where id=" + req.params.id,[m[41m[m
[32m+[m[32m            (err, result) => {[m[41m[m
[32m+[m[32m                if (err) console.log(err);[m[41m[m
[32m+[m[32m                io.emit("delete category", {[m[41m[m
[32m+[m[32m                    id: req.params.id[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m                res.json({[m[41m[m
[32m+[m[32m                    message: "ok"[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m    })[m[41m[m
[32m+[m[32m    .patch((req, res) => {[m[41m[m
[32m+[m[32m        let set = "set ";[m[41m[m
[32m+[m[32m        if (req.body.name) set += "name='" + req.body.name + "' ";[m[41m[m
[32m+[m[32m        if (set !== "set ")[m[41m[m
[32m+[m[32m            connection.query([m[41m[m
[32m+[m[32m                "update categories " + set + "where id=" + req.params.id,[m[41m[m
[32m+[m[32m                (err, result) => {[m[41m[m
[32m+[m[32m                    if (err) console.error(err);[m[41m[m
[32m+[m[32m                    req.body.id = req.params.id;[m[41m[m
[32m+[m[32m                    io.emit("update categories", req.body);[m[41m[m
[32m+[m[32m                    res.json({});[m[41m[m
[32m+[m[32m                }[m[41m[m
[32m+[m[32m            );[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[41m[m
[32m+[m[32mexport default router;[m[41m[m
[1mdiff --git a/routes/api/index.js b/routes/api/index.js[m
[1mindex 24f90a7..8c4f112 100644[m
[1m--- a/routes/api/index.js[m
[1m+++ b/routes/api/index.js[m
[36m@@ -1,8 +1,8 @@[m
[31m-import express from "express";[m
[31m-import CategoriesRouter from "./categoriesRouter";[m
[31m-import MaterialsRouter from "./materialsRouter";[m
[31m-[m
[31m-const router = express.Router();[m
[31m-router.use("/categories", CategoriesRouter);[m
[31m-router.use("/materials", MaterialsRouter);[m
[31m-export default router;[m
[32m+[m[32mimport express from "express";[m[41m[m
[32m+[m[32mimport CategoriesRouter from "./categoriesRouter";[m[41m[m
[32m+[m[32mimport MaterialsRouter from "./materialsRouter";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst router = express.Router();[m[41m[m
[32m+[m[32mrouter.use("/categories", CategoriesRouter);[m[41m[m
[32m+[m[32mrouter.use("/materials", MaterialsRouter);[m[41m[m
[32m+[m[32mexport default router;[m[41m[m
[1mdiff --git a/routes/api/materialsRouter.js b/routes/api/materialsRouter.js[m
[1mindex e158ea9..722193a 100644[m
[1m--- a/routes/api/materialsRouter.js[m
[1m+++ b/routes/api/materialsRouter.js[m
[36m@@ -1,81 +1,81 @@[m
[31m-import express from "express";[m
[31m-[m
[31m-const router = express.Router();[m
[31m-[m
[31m-router[m
[31m-    .route("/")[m
[31m-    .get((req, res) => {[m
[31m-        connection.query([m
[31m-            "SELECT m.id, m.name, m.format, m.quantity, m.minquantity FROM categories c INNER JOIN products m ON c.id = m.categorie_id WHERE m.categorie_id=" +[m
[31m-                req.query.id,[m
[31m-            (err, result) => {[m
[31m-                if (err) console.log(err);[m
[31m-                res.send({[m
[31m-                    materials: result[m
[31m-                });[m
[31m-            }[m
[31m-        );[m
[31m-    })[m
[31m-    .post((req, res) => {[m
[31m-        if (req.body.id === undefined) {[m
[31m-            res.send({});[m
[31m-            return;[m
[31m-        }[m
[31m-        const defaultValues = [0, "Name", "Format", 0, 0];[m
[31m-        // transform data into value string[m
[31m-        const data = [...defaultValues, req.body.id][m
[31m-            .map(val => "'" + val + "'")[m
[31m-            .join(", ");[m
[31m-        connection.query([m
[31m-            "insert into products(`id`,`name`,`format`,`quantity`,`minquantity`,`categorie_id`) values(" +[m
[31m-                data +[m
[31m-                ")",[m
[31m-            (err, result) => {[m
[31m-                if (err) console.log(err);[m
[31m-                io.emit("new material", {[m
[31m-                    name: defaultValues[1],[m
[31m-                    format: defaultValues[2],[m
[31m-                    quantity: defaultValues[3],[m
[31m-                    minquantity: defaultValues[4],[m
[31m-                    id: result.insertId,[m
[31m-                    categorie_id: req.body.id[m
[31m-                });[m
[31m-                res.send({});[m
[31m-            }[m
[31m-        );[m
[31m-    });[m
[31m-router[m
[31m-    .route("/:id")[m
[31m-    .delete((req, res) => {[m
[31m-        connection.query([m
[31m-            "delete from products where id=" + req.params.id,[m
[31m-            (err, result) => {[m
[31m-                if (err) console.error(err);[m
[31m-                io.emit("delete material", {[m
[31m-                    id: req.params.id,[m
[31m-                    category_id: req.body.category_id[m
[31m-                });[m
[31m-                res.send({});[m
[31m-            }[m
[31m-        );[m
[31m-    })[m
[31m-    .patch((req, res) => {[m
[31m-        let set = "set ";[m
[31m-        if (req.body.quantity)[m
[31m-            set += "quantity=quantity+" + parseInt(req.body.quantity) + " ";[m
[31m-        if (req.body.minquantity)[m
[31m-            set += "minquantity=" + req.body.minquantity + " ";[m
[31m-        if (req.body.name) set += "name='" + req.body.name + "' ";[m
[31m-        if (req.body.format) set += "format='" + req.body.format + "' ";[m
[31m-        if (set !== "set ")[m
[31m-            connection.query([m
[31m-                "update products " + set + "where id=" + req.body.id,[m
[31m-                (err, result) => {[m
[31m-                    if (err) console.error(err);[m
[31m-                    io.emit("update material", req.body);[m
[31m-                    res.json({});[m
[31m-                }[m
[31m-            );[m
[31m-    });[m
[31m-[m
[31m-export default router;[m
[32m+[m[32mimport express from "express";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst router = express.Router();[m[41m[m
[32m+[m[41m[m
[32m+[m[32mrouter[m[41m[m
[32m+[m[32m    .route("/")[m[41m[m
[32m+[m[32m    .get((req, res) => {[m[41m[m
[32m+[m[32m        connection.query([m[41m[m
[32m+[m[32m            "SELECT m.id, m.name, m.format, m.quantity, m.minquantity FROM categories c INNER JOIN products m ON c.id = m.categorie_id WHERE m.categorie_id=" +[m[41m[m
[32m+[m[32m                req.query.id,[m[41m[m
[32m+[m[32m            (err, result) => {[m[41m[m
[32m+[m[32m                if (err) console.log(err);[m[41m[m
[32m+[m[32m                res.send({[m[41m[m
[32m+[m[32m                    materials: result[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m    })[m[41m[m
[32m+[m[32m    .post((req, res) => {[m[41m[m
[32m+[m[32m        if (req.body.id === undefined) {[m[41m[m
[32m+[m[32m            res.send({});[m[41m[m
[32m+[m[32m            return;[m[41m[m
[32m+[m[32m        }[m[41m[m
[32m+[m[32m        const defaultValues = [0, "Name", "Format", 0, 0];[m[41m[m
[32m+[m[32m        // transform data into value string[m[41m[m
[32m+[m[32m        const data = [...defaultValues, req.body.id][m[41m[m
[32m+[m[32m            .map(val => "'" + val + "'")[m[41m[m
[32m+[m[32m            .join(", ");[m[41m[m
[32m+[m[32m        connection.query([m[41m[m
[32m+[m[32m            "insert into products(`id`,`name`,`format`,`quantity`,`minquantity`,`categorie_id`) values(" +[m[41m[m
[32m+[m[32m                data +[m[41m[m
[32m+[m[32m                ")",[m[41m[m
[32m+[m[32m            (err, result) => {[m[41m[m
[32m+[m[32m                if (err) console.log(err);[m[41m[m
[32m+[m[32m                io.emit("new material", {[m[41m[m
[32m+[m[32m                    name: defaultValues[1],[m[41m[m
[32m+[m[32m                    format: defaultValues[2],[m[41m[m
[32m+[m[32m                    quantity: defaultValues[3],[m[41m[m
[32m+[m[32m                    minquantity: defaultValues[4],[m[41m[m
[32m+[m[32m                    id: result.insertId,[m[41m[m
[32m+[m[32m                    categorie_id: req.body.id[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m                res.send({});[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[32mrouter[m[41m[m
[32m+[m[32m    .route("/:id")[m[41m[m
[32m+[m[32m    .delete((req, res) => {[m[41m[m
[32m+[m[32m        connection.query([m[41m[m
[32m+[m[32m            "delete from products where id=" + req.params.id,[m[41m[m
[32m+[m[32m            (err, result) => {[m[41m[m
[32m+[m[32m                if (err) console.error(err);[m[41m[m
[32m+[m[32m                io.emit("delete material", {[m[41m[m
[32m+[m[32m                    id: req.params.id,[m[41m[m
[32m+[m[32m                    category_id: req.body.category_id[m[41m[m
[32m+[m[32m                });[m[41m[m
[32m+[m[32m                res.send({});[m[41m[m
[32m+[m[32m            }[m[41m[m
[32m+[m[32m        );[m[41m[m
[32m+[m[32m    })[m[41m[m
[32m+[m[32m    .patch((req, res) => {[m[41m[m
[32m+[m[32m        let set = "set ";[m[41m[m
[32m+[m[32m        if (req.body.quantity)[m[41m[m
[32m+[m[32m            set += "quantity=quantity+" + parseInt(req.body.quantity) + " ";[m[41m[m
[32m+[m[32m        if (req.body.minquantity)[m[41m[m
[32m+[m[32m            set += "minquantity=" + req.body.minquantity + " ";[m[41m[m
[32m+[m[32m        if (req.body.name) set += "name='" + req.body.name + "' ";[m[41m[m
[32m+[m[32m        if (req.body.format) set += "format='" + req.body.format + "' ";[m[41m[m
[32m+[m[32m        if (set !== "set ")[m[41m[m
[32m+[m[32m            connection.query([m[41m[m
[32m+[m[32m                "update products " + set + "where id=" + req.body.id,[m[41m[m
[32m+[m[32m                (err, result) => {[m[41m[m
[32m+[m[32m                    if (err) console.error(err);[m[41m[m
[32m+[m[32m                    io.emit("update material", req.body);[m[41m[m
[32m+[m[32m                    res.json({});[m[41m[m
[32m+[m[32m                }[m[41m[m
[32m+[m[32m            );[m[41m[m
[32m+[m[32m    });[m[41m[m
[32m+[m[41m[m
[32m+[m[32mexport default router;[m[41m[m
[1mdiff --git a/routes/index.js b/routes/index.js[m
[1mindex 4d62ac7..eb5a7fc 100644[m
[1m--- a/routes/index.js[m
[1m+++ b/routes/index.js[m
[36m@@ -1,15 +1,15 @@[m
[31m-import express from "express";[m
[31m-import path from "path";[m
[31m-import ApiRouter from "./api";[m
[31m-[m
[31m-const router = express.Router();[m
[31m-[m
[31m-router.get("/", (req, res) => {[m
[31m-  res.render("main", { isHome: true });[m
[31m-});[m
[31m-router.use("/api", ApiRouter);[m
[31m-router.get("/repository", (req, res) => {[m
[31m-  res.render("repository", { isRepository: true });[m
[31m-});[m
[31m-[m
[31m-export default router;[m
[32m+[m[32mimport express from "express";[m[41m[m
[32m+[m[32mimport path from "path";[m[41m[m
[32m+[m[32mimport ApiRouter from "./api";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst router = express.Router();[m[41m[m
[32m+[m[41m[m
[32m+[m[32mrouter.get("/", (req, res) => {[m[41m[m
[32m+[m[32m  res.render("main", { isHome: true });[m[41m[m
[32m+[m[32m});[m[41m[m
[32m+[m[32mrouter.use("/api", ApiRouter);[m[41m[m
[32m+[m[32mrouter.get("/repository", (req, res) => {[m[41m[m
[32m+[m[32m  res.render("repository", { isRepository: true });[m[41m[m
[32m+[m[32m});[m[41m[m
[32m+[m[41m[m
[32m+[m[32mexport default router;[m[41m[m
[1mdiff --git a/server.js b/server.js[m
[1mindex a2fbbdc..13f7636 100644[m
[1m--- a/server.js[m
[1m+++ b/server.js[m
[36m@@ -1,39 +1,39 @@[m
[31m-import express from "express";[m
[31m-import http from "http";[m
[31m-import bodyParser from "body-parser";[m
[31m-import path from "path";[m
[31m-import hbs from "express-handlebars";[m
[31m-import router from "./routes";[m
[31m-import mysql from "mysql";[m
[31m-import socketIo from "socket.io";[m
[31m-[m
[31m-const app = express();[m
[31m-[m
[31m-app.engine([m
[31m-    "hbs",[m
[31m-    hbs({[m
[31m-        extname: "hbs",[m
[31m-        defaultLayout: "layout",[m
[31m-        layoutsDir: path.join(__dirname, "views/layouts"),[m
[31m-        partialsDir: path.join(__dirname, "views/partials")[m
[31m-    })[m
[31m-);[m
[31m-app.set("views", path.join(__dirname, "views"));[m
[31m-app.set("view engine", "hbs");[m
[31m-app.use(express.static(path.join(__dirname, "public")));[m
[31m-app.use(bodyParser.urlencoded({ extended: false }));[m
[31m-app.use(router);[m
[31m-[m
[31m-global.connection = mysql.createConnection({[m
[31m-    host: "localhost",[m
[31m-    user: "root",[m
[31m-    password: "password",[m
[31m-    database: "Colour&Point_development"[m
[31m-});[m
[31m-[m
[31m-global.connection.connect();[m
[31m-[m
[31m-const server = http.Server(app);[m
[31m-global.io = socketIo(server);[m
[31m-[m
[31m-server.listen(80);[m
[32m+[m[32mimport express from "express";[m[41m[m
[32m+[m[32mimport http from "http";[m[41m[m
[32m+[m[32mimport bodyParser from "body-parser";[m[41m[m
[32m+[m[32mimport path from "path";[m[41m[m
[32m+[m[32mimport hbs from "express-handlebars";[m[41m[m
[32m+[m[32mimport router from "./routes";[m[41m[m
[32m+[m[32mimport mysql from "mysql";[m[41m[m
[32m+[m[32mimport socketIo from "socket.io";[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst app = express();[m[41m[m
[32m+[m[41m[m
[32m+[m[32mapp.engine([m[41m[m
[32m+[m[32m    "hbs",[m[41m[m
[32m+[m[32m    hbs({[m[41m[m
[32m+[m[32m        extname: "hbs",[m[41m[m
[32m+[m[32m        defaultLayout: "layout",[m[41m[m
[32m+[m[32m        layoutsDir: path.join(__dirname, "views/layouts"),[m[41m[m
[32m+[m[32m        partialsDir: path.join(__dirname, "views/partials")[m[41m[m
[32m+[m[32m    })[m[41m[m
[32m+[m[32m);[m[41m[m
[32m+[m[32mapp.set("views", path.join(__dirname, "views"));[m[41m[m
[32m+[m[32mapp.set("view engine", "hbs");[m[41m[m
[32m+[m[32mapp.use(express.static(path.join(__dirname, "public")));[m[41m[m
[32m+[m[32mapp.use(bodyParser.urlencoded({ extended: false }));[m[41m[m
[32m+[m[32mapp.use(router);[m[41m[m
[32m+[m[41m[m
[32m+[m[32mglobal.connection = mysql.createConnection({[m[41m[m
[32m+[m[32m    host: "localhost",[m[41m[m
[32m+[m[32m    user: "root",[m[41m[m
[32m+[m[32m    password: "password",[m[41m[m
[32m+[m[32m    database: "Colour&Point_development"[m[41m[m
[32m+[m[32m});[m[41m[m
[32m+[m[41m[m
[32m+[m[32mglobal.connection.connect();[m[41m[m
[32m+[m[41m[m
[32m+[m[32mconst server = http.Server(app);[m[41m[m
[32m+[m[32mglobal.io = socketIo(server);[m[41m[m
[32m+[m[41m[m
[32m+[m[32mserver.listen(80);[m[41m[m
[1mdiff --git a/views/layouts/layout.hbs b/views/layouts/layout.hbs[m
[1mindex 6d95e9f..207d895 100644[m
[1m--- a/views/layouts/layout.hbs[m
[1m+++ b/views/layouts/layout.hbs[m
[36m@@ -1,27 +1,27 @@[m
[31m-<!DOCTYPE html>[m
[31m-<html lang="en">[m
[31m-[m
[31m-<head>[m
[31m-    <meta charset="UTF-8">[m
[31m-    <meta name="viewport" content="width=device-width, initial-scale=1.0">[m
[31m-    <meta http-equiv="X-UA-Compatible" content="ie=edge">[m
[31m-    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico.png" />[m
[31m-    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css" />[m
[31m-    <script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="[m
[31m-        crossorigin="anonymous"></script>[m
[31m-    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="[m
[31m-        crossorigin="anonymous"></script>[m
[31m-    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>[m
[31m-    <script src="/js/sortable.js"></script>[m
[31m-    <script src="/socket.io/socket.io.jst"></script>[m
[31m-    <link rel="stylesheet" href="/css/layout.css">[m
[31m-    <script src="/js/layout.js"></script>[m
[31m-    <title>Colour&Point</title>[m
[31m-</head>[m
[31m-[m
[31m-<body>[m
[31m-    {{> navbar}}[m
[31m-    <div class="">{{{body}}}</div>[m
[31m-</body>[m
[31m-[m
[32m+[m[32m<!DOCTYPE html>[m[41m[m
[32m+[m[32m<html lang="en">[m[41m[m
[32m+[m[41m[m
[32m+[m[32m<head>[m[41m[m
[32m+[m[32m    <meta charset="UTF-8">[m[41m[m
[32m+[m[32m    <meta name="viewport" content="width=device-width, initial-scale=1.0">[m[41m[m
[32m+[m[32m    <meta http-equiv="X-UA-Compatible" content="ie=edge">[m[41m[m
[32m+[m[32m    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico.png" />[m[41m[m
[32m+[m[32m    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css" />[m[41m[m
[32m+[m[32m    <script src="http://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="[m[41m[m
[32m+[m[32m        crossorigin="anonymous"></script>[m[41m[m
[32m+[m[32m    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="[m[41m[m
[32m+[m[32m        crossorigin="anonymous"></script>[m[41m[m
[32m+[m[32m    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>[m[41m[m
[32m+[m[32m    <script src="/js/sortable.js"></script>[m[41m[m
[32m+[m[32m    <script src="/socket.io/socket.io.jst"></script>[m[41m[m
[32m+[m[32m    <link rel="stylesheet" href="/css/layout.css">[m[41m[m
[32m+[m[32m    <script src="/js/layout.js"></script>[m[41m[m
[32m+[m[32m    <title>Colour&Point</title>[m[41m[m
[32m+[m[32m</head>[m[41m[m
[32m+[m[41m[m
[32m+[m[32m<body>[m[41m[m
[32m+[m[32m    {{> navbar}}[m[41m[m
[32m+[m[32m    <div class="">{{{body}}}</div>[m[41m[m
[32m+[m[32m</body>[m[41m[m
[32m+[m[41m[m
 </html>[m
\ No newline at end of file[m
[1mdiff --git a/views/partials/addQuantityPopup.hbs b/views/partials/addQuantityPopup.hbs[m
[1mindex 2668904..0fc8491 100644[m
[1m--- a/views/partials/addQuantityPopup.hbs[m
[1m+++ b/views/partials/addQuantityPopup.hbs[m
[36m